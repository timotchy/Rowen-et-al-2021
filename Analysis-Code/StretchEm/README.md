# StretchEm: Basic Use Instructions
StretchEm is used to control for temporal variability in bird song by aligning syllable motifs using a dynamic time warping algorithm. It provides a better way to find the beginnings and endings of syllables. Its goal is to find corresponding points of different songs that match up. The only difference between StretchEmLite and this application is the ability to view electrophysiology data with the audio data. StretchEm also allows you to adjust the lag between the electrophysiology data and the audio data (based on predetermined lag times calculated based on the position of electrodes in the bird's brain). 
## Interface Description: 
![StretchEm.png](https://user-images.githubusercontent.com/18174572/41361326-c6cbdd76-6efc-11e8-9ae1-bfa347f77fd9.png)
* **Status Box**: This box provides information about the loading of different files and folders as well as the creation of the data set.
* **File Control**: This panel, directly underneath the status box, is used to load in all of the necessary inputs to the StretchEmLite functions. 
    * Add Annotation: opens a finder window in which you choose the annotation file you would like to use for your analysis
    * Add Data Folder: opens a finder window in which you select the folder of song recordings you wish to analyze
    * Clear Annotations: removes currently loaded annotation(s)
    * Clear Folders: removes currently loaded folder(s)
    * Load Syl Pattern: opens a finder window in which you select the syllable pattern for the bird whose song you are analyzing
    * Load WAVS/Load DATS/Load STMs: select which type of files you would like to load
    * Create Dataset: Create a dataset to be used for your analysis based on the annotation, recordings folder, and syllable pattern you loaded in
* **Record Selection/Sorting**: This panel is for filtering *which* files you want to use in your analysis. 
    * From Record/To Record: allow you to filter for specific times within the folder of recordings based on the universal time stamp; when you change this it will change the entries in From Time/To Time to the corresponding values
    * From Time/To Time: see above
    * Directed Status Dropdown/Drug Status Dropdown: provide more information about which recordings you would like to include
    * Sort Drugs/Sort Direct/Sort Chrono: Sorts recordings based on selected criteria
* **Motif Selection**: In this panel, you select the specific sequence of syllables that you would like to align. 
    * Number of Syllables: chose number of syllables for the motif you would like to align
    * Choose Sequence: choose specific syllable sequence you would like to align
    * Sequence Stats: displays a graphic that shows you which syllables occur when in the bird songs (in reference to other syllables)
* **Data Processing**: This panel allows you to adjust the filtering and other settings for the files before you align them.
    * Gain/High Pass/Low Pass: apply gain or filter to the audio recordings
    * Up/Down Arrows: scroll through the recordings and compare them to the alignment template in a separate window
    * Flag: mark misaligned patterns
    * Edge Threshold: NOT IMPORTANT
    * Buffer: number of ms on either side of the motif
    * DTW Band: limits how much stretch between songs you are trying to align
    * Offset: NOT IMPORTANT
    * Channel: select which channel of E-phys data you would like to view
    * CMS/Vref: Common mode subtraction and virtual referencing for the E-phys data
    * Single Spotlight: if unchecked, this will open a new window every time you page through the motifs
    * Normalize: normalizes spectrograms prior to alignment
* **Alignment**: This is where the main function of the StretchEmLite application happens. Here you select the type of alignment you would like to use and then align all of the selected motifs. When the "ALIGN!" button is pressed, it opens up a different popup window in which you can add additional specifications for the alignment before you get the final result. 
    * Dropdown Menu: select desired alignment type
        * Local Linear: align by start and end of each syllable
        * Global Linear: align just based on start and end of the recordings
        * Align Start: only align to onset of each motif
        * Full DTW: uses dynamic time warping algorithm 
    * ALIGN!: aligns selected motifs
    * Float Ends: recordings do not all have to start at the same time bins
    * Common Template: allows you to choose a previously generated alignment template from the finder
    * Lag: adjust delay between E-phys and audio data
* **Export**: This panel is dedicated to saving any of the analysis generated by StretchEmLite that you deem important to your work
    * Export Raw Motifs: export all of the audio files for the specific motif you selected
    * Export Processed: export all the newly aligned audio files of the motif
    * Export Images: export alignment graph
    * Export Template: saves the alignment template for use with other files
    * Export Paths: export alignment paths mapping from slave to template
    * Export Ave Spec: DELETE
    * Export Min Process: DELETE
    * Export Talon: export all information needed for the next round of analysis
* **Keys and Fileslist**: These two lists should have the exact same contents!
* **Graphical Components**: Here is where you can see a visual representation of the aligned audio files and check whether the application succeeded in its alignment. 
    * Top Spectrogram: this displays the alignment template for the current motif
    * Middle Section: shows each instance of the identified motif aligned by the program
    * Bottom Graph: displays the average amplitude of each recording as well as the standard deviation on either side
## Instructions: 
1. Load in an annotation file, data folder of all of the song recordings from one day for a single bird, and a syllable pattern for that bird using the File Control panel
2. Click "Create Dataset"
3. Use the Motif Selection panel to select which specific sequence of syllables you would like to align
4. Use the Record Selection/Sorting panel to choose which specific instances of the chosen motif you would like to align
5. Use the Data Processing panel to apply any desired filters to the audio data
6. Use the Lag box in the Alignment panel to adjust the delay between the electrophysiology data and the audio data
7. Choose the alignment method in the dropdown menu of the Alignment panel and hit "ALIGN!"
8. The template bender window will pop up; here you can adjust the threshold crossing for the syllables until you obtain the desired division between syllables; when you are satisfied, press the "Close & Update" button
9. Several graphs that show essentiall the "amount of warping" done to each file will appear
10. Use the arrows in the Data Processing panel to view specific files next to the alignment template in a separate window
11. Use the flag to mark any misaligned patterns
12. Export relevant data using the Export panel (the *talon* file contains all of the information necessary for the next round of analysis)







